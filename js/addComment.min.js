var commentConfig={sendcomments:"http://site.proc.sina.cn/cmnt/post_ajax.php",user:{usernick:""},logout:{switchurl:"http://passport.sina.cn/signin/signin?entry=wapsso&revalid=2&r="+encodeURIComponent(__docConfig.__docUrl),logouturl:"http://passport.sina.cn/sso/logout?entry=wapsso&r="+encodeURIComponent(__docConfig.__docUrl)},login:{loginurl:"http://passport.sina.cn/signin/signin?entry=wapsso&r="+encodeURIComponent(__docConfig.__docUrl)+"&backTitle="+encodeURIComponent(__docConfig.__title),signup:"http://passport.sina.cn/signup/signup?r="+encodeURIComponent(__docConfig.__docUrl)},comt:{show:true,url:__docConfig.__cmntListUrl,comt_num:__docConfig.__cmntTotal},favor:{show:false},share:{show:true,url:"http://share.sina.cn/callback?url="+encodeURIComponent(__docConfig.__docUrl)+"&title="+encodeURIComponent(__docConfig.__title)+"&pic="+__docConfig.__mainPic+"&content="+encodeURIComponent(__docConfig.__content)},suda:__docConfig.__suda||""};function Comment(A){if(!arguments.length){return}window.ishare=window.ishare||false;this.shareBtn=window.ishare?"j_shareBtn":"j_share_btn";this.options=A||{};this.options.main=$("body");this.options.closefloatlayer=commentConfig.closefloatlayer||false;this.options.commentCallBack=A.commentCallBack||null;this.options.commentPageCallBack=A.commentPageCallBack||null;this.options.shareCallBack=A.shareCallBack||null;this.options.cmtsmtCallBack=A.cmtsmtCallBack||null;this.options.cmtcancelCallBack=A.cmtcancelCallBack||null;this.options.setTop=A.setTop||false;this.options.screenScroll=0;commentConfig.dnick="手机新浪网用户";commentConfig.dface="http://mjs.sinaimg.cn/wap/module/short_comment/201506041400/images/dface.gif";this.sending=0;commentConfig.comt=commentConfig.comt||{};commentConfig.favor=commentConfig.favor||{};commentConfig.share=commentConfig.share||{};commentConfig.comt.comt_num=commentConfig.comt.comt_num||"0";commentConfig.comtTitle=commentConfig.comtTitle||"说说你的看法";commentConfig.closeComment=commentConfig.closeComment||false;if(window.__if_cmnt){commentConfig.share.show=false;commentConfig.comt.show=false;commentConfig.favor.show=false}else{commentConfig.comt.show=commentConfig.comt.show||false;commentConfig.favor.show=commentConfig.favor.show||false;commentConfig.share.show=commentConfig.share.show||false}commentConfig.login=commentConfig.login||{};commentConfig.login.loginurl=commentConfig.login.loginurl||"";commentConfig.login.signup=commentConfig.login.signup||"";commentConfig.logout=commentConfig.logout||{};commentConfig.logout.switchurl=commentConfig.logout.switchurl||"";commentConfig.logout.logouturl=commentConfig.logout.logouturl||"";if(!window.__userConfig__){__userConfig__={};__userConfig__.__isLogin=commentConfig.user.isLogin||globalConfig.islogin}if(commentConfig.closeComment){return}commentConfig.suda=commentConfig.suda||"comment";this.ua=window.navigator.userAgent.toLowerCase();this._createDOM();this._addEvent();getUserInfo(function(B){if(B.uid){commentConfig.user={isLogin:B.uid,usernick:B.uname||commentConfig.dnick,userface:B.userface||commentConfig.dface}}else{commentConfig.user={}}})}var oMeta=document.getElementsByName("viewport")[0];Comment.prototype._addcss=function(){};Comment.prototype._createDOM=function(){window._this=this;var A=[];if(!this.options.closefloatlayer){A.push("<aside>");A.push('<div class="foot_comment">');A.push('<div class="foot_commentcont">');A.push('<div class="foot_cmt_input j_cmt_btn" data-sudaclick="'+commentConfig.suda+'_cmt_btn"><p>'+commentConfig.comtTitle+"</p>");A.push("</div>");if(commentConfig.favor.show){A.push('<div class="foot_cmt_favor j_iadd_btn"></div>')}if(commentConfig.comt.show){A.push('<div class="foot_cmt_num j_p_comt">');A.push('<a href="'+commentConfig.comt.url+'" title="" data-sudaclick="'+commentConfig.suda+'_comt">');A.push('<span class="cmt_num_t">'+commentConfig.comt.comt_num+"</span></a></div>")}if(commentConfig.share.show){A.push('<div class="foot_cmt_share '+this.shareBtn+'"></div>')}if(!commentConfig.comt.show&&!commentConfig.share.show&&!commentConfig.favor.show){A.push('<div class="foot_cmt_num j_cmt_btn">');A.push('<a href="javascript:;" title="">');A.push('<span class="cmt_num_t" data-sudaclick="'+commentConfig.suda+'_cmt_btn">'+commentConfig.comt.comt_num+"</span></a></div>")}A.push("</div></div></aside>")}A.push('<div class="cmnt_pop" id="j_cmnt_pop"></div>');A.push('<aside id="tipsCeng" class="tipsCeng">');A.push('<div class="comment_remind animation_marker">');A.push('<p class="marker_t">您已发送成功！</p>');A.push("</div>");A.push("</aside>");$("body").parent().append(A.join(""))};Comment.prototype._addFloat=function(){if($(".cmnt_wrap").length>0){return}var B=[];B.push('<div class="cmnt_wrap">');B.push('<div class="cmnt_tp">');B.push('<span class="fl"><a href="javascript:void(0);" class="cmnt_cancel" id="j_cmnt_cancel" data-sudaclick="'+commentConfig.suda+'_send_cancel">取消</a></span>');B.push('<span class="fr"><a href="javascript:void(0);" class="cmnt_smt" id="j_cmnt_smt" data-sudaclick="'+commentConfig.suda+'_send_cmnt">发送</a></span>');B.push("</div>");B.push('<div class="cmnt_login">');B.push('<span class="fl"><img src="'+commentConfig.user.userface+'">'+commentConfig.user.usernick+"</span>");B.push('<span class="fr"><a href="'+commentConfig.logout.switchurl+'">切换账号</a>&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;<a href="'+commentConfig.logout.logouturl+'">登出</a>');B.push("</span></div>");B.push('<div class="cmntarea">');B.push('<textarea id="j_cmnt_input" class="newarea" name="" placeholder="'+commentConfig.comtTitle+'"></textarea>');B.push("</div>");B.push('<div class="cmnt_bm">');B.push('<span class="fl"><input type="checkbox" id="j_wb_sendcont" name="" value="1" checked>&nbsp;&nbsp;同时转发到微博</span>');B.push("</div></div>");this.oCmtArea.append(B.join(""));this.oTextarea=$("#j_cmnt_input");this.oWb_sendcont=$("#j_wb_sendcont");var E=this;if(E.oWb_sendcont.length>0){if(D("commentCheck")=="0"){E.oWb_sendcont[0].checked=""}if($("#j_input_check").length>0){$("#j_input_check").on("click",function(){if(this.checked){A("commentCheck","1");E.oWb_sendcont[0].checked="checked"}else{A("commentCheck","0");E.oWb_sendcont[0].checked=""}})}E.oWb_sendcont.on("click",function(){if(this.checked){A("commentCheck","1",999);if($("#j_input_check").length>0){$("#j_input_check")[0].checked="checked"}}else{A("commentCheck","0",999);if($("#j_input_check").length>0){$("#j_input_check")[0].checked=""}}});function A(F,L,K,J,H,G){var I=new Date();I.setDate(I.getDate()+K);document.cookie=F+"="+escape(L)+((K)?"; expires="+I:"")+"; path=/; domain=sina.cn"}function D(F){if(undefined==F||""==F){return false}return C(document.cookie,F,";","")}function C(K,J,I,G){if(K==""){return""}G=(G=="")?"=":G;J+=G;var F=K.indexOf(J);if(F<0){return""}F+=J.length;var H=K.indexOf(I,F);if(H<F){H=K.length}return K.substring(F,H)}}};Comment.prototype._addEvent=function(){this.oShare=$("."+this.shareBtn),this.oComment=$(".j_p_comt"),this.oCmtText=$(".j_cmt_btn"),this.oCmtArea=$("#j_cmnt_pop"),this.oMainWrap=this.options.main,this.oSucTips=$("#tipsCeng"),this.oreplybtn=$(".replybtn"),this.owb_ico=$(".wb_ico");this.oFoot_comment=$(".foot_comment");this.oCmnt_login=$(".cmnt_login");this.oWb_sendcont=$("#j_wb_sendcont");this.focusStatus=0;oViedo=$("video");var G=this;addCommentlogin=(typeof(WapLogin)=="function")?(new WapLogin()):this;this.oFoot_comment.on("click",".j_cmt_btn",function(H){if(__userConfig__.__isLogin||commentConfig.user.isLogin){G.commentShow()}else{addCommentlogin.login(false,function(){commentConfig.user.isLogin=true;commentConfig.user.usernick=__userConfig__.__unick||commentConfig.dnick;commentConfig.user.userface=__userface=__userConfig__.__uface||commentConfig.dface;G._addFloat();G._addEvent();if(window.loginActive=="j_cmt_btn"){G.commentShow()}});window.loginActive="j_cmt_btn"}});if(!window.ishare){this.oFoot_comment.on("click","."+G.shareBtn,function(H){if(!commentConfig.user.isLogin){addCommentlogin.login(false,function(){if(window.loginActive==G.shareBtn){window.location.href=$("."+G.shareBtn+" a").data("href")}commentConfig.user.isLogin=true;commentConfig.user.usernick=__userConfig__.__unick||commentConfig.dnick;commentConfig.user.userface=__userface=__userConfig__.__uface||commentConfig.dface;G._addFloat();G._addEvent()});window.loginActive=G.shareBtn;H.preventDefault()}else{window.location.href=$("."+G.shareBtn+" a").data("href")}})}if(commentConfig.user.isLogin&&commentConfig.user.userface==""){var E="http://passport.sina.cn/sso/islogin?entry=wapsso&";jsonp(E,{},function(H){G.oCmnt_login.find("img").attr("src",H.data.portrait_url)})}if(commentConfig.user.isLogin){var B=223}else{var B=193}if(!this.options.setTop){if($("#j_blankBox").length==0){this.oCmtArea.prepend('<div id="j_blankBox" style="width:100%; height:'+(document.documentElement.clientHeight-B+10)+'px;"></div>')}}if(window.navigator.userAgent.toLowerCase().indexOf("ucbrowser")==-1){}else{this.oCmtArea.css("paddingBottom",20+"px")}this.oShare_layer=$("#sharebox");if(this.oShare_layer.length>0){this.oShare_layer.on("click",function(){if(oViedo.length>0){if(oViedo[0].getBoundingClientRect().bottom>0){window.scrollTo(0,document.body.scrollTop+oViedo[0].getBoundingClientRect().bottom)}}window.removeEventListener("touchmove",prevent,false);G.oFoot_comment.hide()})}$(window).on("click tap","#j_cmnt_smt",function(){if(!G.sending){G.sending=1;if(G.options.cmtsmtCallBack){G.options.cmtsmtCallBack(G.oTextarea[0].value,G._commentSuccess,G)}else{C(G.oTextarea[0].value,G._commentSuccess,G)}setTimeout(function(){G.sending=0},3000)}});$(window).on("input","#j_cmnt_input",function(){try{localStorage.textarea=this.value}catch(H){}});if(F("commentCheck")=="0"){if($("#j_input_check").length>0){$("#j_input_check")[0].checked=""}}else{if($("#j_input_check").length>0){$("#j_input_check")[0].checked="checked"}}if($("#j_input_check").length>0){$("#j_input_check").on("click",function(){if(this.checked){A("commentCheck","1");if($("#j_wb_sendcont").length>0){$("#j_wb_sendcont")[0].checked="checked"}}else{A("commentCheck","0");if($("#j_wb_sendcont").length>0){$("#j_wb_sendcont")[0].checked=""}}})}$(window).on("click tap","#j_cmnt_cancel",function(){G.commentHide();G.options.cmtcancelCallBack&&G.options.cmtcancelCallBack()});setTimeout(function(){window.addEventListener("scroll",function(){if(G.oFoot_comment.css("display")=="none"&&G.oCmtArea.css("display")!="block"){if($("#showpic_box").length>0){if($("#showpic_box").hasClass("hide")){G.oFoot_comment.show()}}else{if($(".J-slider").length>0){}else{G.oFoot_comment.show()}}}},false)},500);function C(H,I,J){if(H==""){$(".j_op_remind").eq(0).show().html("请输入评论内容！").addClass("animate");setTimeout(function(){$(".j_op_remind").eq(0).html("").removeClass("animate").hide()},3000)}else{if(H.indexOf("script")==-1){if($("#j_wb_sendcont").is(":checked")){towb=1}else{towb=""}I&&I.call(J);$.ajax({type:"GET",url:commentConfig.sendcomments,data:{domain:CMNT.domain,product:CMNT.product,index:CMNT.index,vcode:CMNT.vcode,csrfcode:CMNT.csrfcode,csrftime:CMNT.csrftime,wburl:CMNT.wburl,vt:4,cmntContent:H,towb:towb,jsoncallback:"callbackComment"},dataType:"jsonp",async:false,success:function(K){},error:function(L,K){}})}else{$(".j_op_remind").eq(0).show().html("请您检查输入内容！").addClass("animate");setTimeout(function(){$(".j_op_remind").eq(0).html("").removeClass("animate").hide()},3000)}}}function A(H,N,M,L,J,I){var K=new Date();K.setDate(K.getDate()+M);document.cookie=H+"="+escape(N)+((M)?"; expires="+K:"")+"; path=/; domain=sina.cn"}function F(H){if(undefined==H||""==H){return false}return D(document.cookie,H,";","")}function D(M,L,K,I){if(M==""){return""}I=(I=="")?"=":I;L+=I;var H=M.indexOf(L);if(H<0){return""}H+=L.length;var J=M.indexOf(K,H);if(J<H){J=M.length}return M.substring(H,J)}};window.callbackComment=function(){};function changSize(){var B=document.documentElement.clientHeight;var A=223;$("#j_cmnt_pop").css("paddingTop",B-A)}function prevent(A){A.preventDefault();return}Comment.prototype.commentShow=function(){if($(".cmnt_wrap").length==0){_this._addFloat()}this.options.commentCallBack&&this.options.commentCallBack();this.options.screenScroll=document.body.scrollTop||document.documentElement.scrollTop;if(this.oMainWrap.length>1){for(var B=0;B<this.oMainWrap.length;B++){this.oMainWrap[B].hide()}}else{if(this.oMainWrap.length==1){this.oMainWrap.hide()}else{return}}this.oFoot_comment.hide();this.oCmtArea.show();this.oTextarea.focus();oMeta.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui";window.scrollTo(0,1);if(this.ua.indexOf("os")!=-1&&this.ua.indexOf("safari")!=-1&&this.ua.indexOf("8")!=-1){var C=this.oCmtArea.find(".cmnt_wrap")[0].offsetTop;window.scrollTo(0,C)}try{localStorage.test="1";if(localStorage.textarea){this.oTextarea[0].value=localStorage.textarea}}catch(A){}};Comment.prototype._commentSuccess=function(){this.oTextarea[0].value="";this.oTextarea[0].placeholder=commentConfig.comtTitle;this.oSucTips.show();_this=this;window.scrollTo(0,12);setTimeout(function(){_this.oSucTips.hide();_this.oCmtArea.hide();if(_this.oMainWrap.length>1){for(var B=0;B<_this.oMainWrap.length;B++){_this.oMainWrap[B].show()}}else{if(_this.oMainWrap.length==1){_this.oMainWrap.show()}else{return}}_this.oFoot_comment.show();window.scrollTo(0,_this.options.screenScroll);oMeta.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"},1500);try{localStorage.textarea=""}catch(A){}};Comment.prototype.commentHide=function(){this.oCmtArea.hide();if(this.oMainWrap.length>1){for(var A=0;A<this.oMainWrap.length;A++){this.oMainWrap[A].show()}}else{if(this.oMainWrap.length==1){this.oMainWrap.show()}else{return}}try{localStorage.textarea=""}catch(B){}this.oFoot_comment.show();this.oTextarea[0].value="";window.scrollTo(0,this.options.screenScroll);oMeta.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"};function jsonp(C,E,D){var G="jsonp_"+Math.random();G=G.replace(".","");window[G]=function(J){D&&D(J);H.removeChild(B);window[G]=null};E.callback=G;var F=[];for(var A in E){F.push(A+"="+encodeURIComponent(E[A]))}var I=F.join("&");var B=document.createElement("script");B.src=C+I;var H=document.getElementsByTagName("head")[0];H.appendChild(B)};