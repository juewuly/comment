$(function(){function t(t){var e=$("#j_pullLoader"),n=e.data("page")||2,s=(e.data("type"),$("#j_newslist"));$.ajax({type:"GET",url:"http://cmnt.sina.cn/aj/cmnt/list?",data:{product:CMNT.product,group:CMNT.group,index:CMNT.index,page:n},dataType:"jsonp",timeout:1e4,success:function(a){if(a.status){var i=s.html(),c=Math.ceil(a.data.total/20),o=a.data.data;if(!o)return;for(var l=o.length,d="",m="",p=0;l>p;p++){var _=o[p].main,u=o[p].reply||[],h=[],f=_.is_wb,v="",j="";if(d+='<div class="cmnt_item" data-mid="'+_.mid+'" data-wbuser= "'+f+'" data-wbname= "'+_.wbname+'"><p class="cmnt_top"><span><img src="'+_.face+'" /><i class="cmnt_nick">'+_.nick+"<em>"+_.source+"</em></i></span></p>",u.length<4)for(var g=0,m="",b="";g<u.length;g++)u[g].surl&&u[g].surl&&u[g].stitle&&u[g].stitle&&(j='<p class="cmnt_quote"><a href="'+u[g].surl+'">'+u[g].stitle+"</a></p>"),b=u[g].content.length>200?u[g].content.substring(0,199)+'<a class="j_cmnt_more">查看全文>></a><span class="hide">'+u[g].content.substr(200)+"</span>":u[g].content,m='<div class="cmnt_base">'+m+'<p class="cmnt_top"><span>'+u[g].nick+'</span><span class="cmnt_source">'+u[g].time+"&nbsp;&nbsp;"+u[g].source+"</span><code>"+(g+1)+'</code></p><p class="cmnt_text">'+b+"</p>"+j+"</div>";else{for(var g=0,b="";g<u.length;g++)u[g].surl&&u[g].surl&&u[g].stitle&&u[g].stitle&&(j='<p class="cmnt_quote"><a href="'+u[g].surl+'">'+u[g].stitle+"</a></p>"),b=u[g].content.length>200?u[g].content.substring(0,199)+'<a class="j_cmnt_more">查看全文>></a><span class="hide">'+u[g].content.substr(200)+"</span>":u[g].content,h[g]='<p class="cmnt_top"><span>'+u[g].nick+'</span><span class="cmnt_source">'+u[g].time+"&nbsp;&nbsp;"+u[g].source+"</span><code>"+(g+1)+'</code></p><p class="cmnt_text">'+b+"</p>"+j+"</div>";for(var g=0,m="",b="";g<u.length;g++)u[g].surl&&u[g].surl&&u[g].stitle&&u[g].stitle&&(j='<p class="cmnt_quote"><a href="'+u[g].surl+'">'+u[g].stitle+"</a></p>"),b=u[g].content.length>200?u[g].content.substring(0,199)+'<a class="j_cmnt_more">查看全文>></a><span class="hide">'+u[g].content.substr(200)+"</span>":u[g].content,0==g?m='<div class="cmnt_base"><p class="cmnt_top"><span>'+u[g].nick+'</span><span class="cmnt_source">'+u[g].time+"&nbsp;&nbsp;"+u[g].source+"</span><code>"+(g+1)+'</code></p><p class="cmnt_text">'+b+"</p>"+j+"</div>":1==g||g>u.length-2?m='<div class="cmnt_base">'+m+'<p class="cmnt_top"><span>'+u[g].nick+'</span><span class="cmnt_source">'+u[g].time+"&nbsp;&nbsp;"+u[g].source+"</span><code>"+(g+1)+'</code></p><p class="cmnt_text">'+b+"</p>"+j+"</div>":m+=2==g?'<a class="cmnt_unfold j_cmnt_unfold" href="javascript:void(0);"><i></i>点击展开隐藏楼层</a><div class="hide"><p class="cmnt_top"><span>'+u[g].nick+'</span><span class="cmnt_source">'+u[g].time+"&nbsp;&nbsp;"+u[g].source+"</span><code>"+(g+1)+'</code></p><p class="cmnt_text">'+b+"</p>"+j+"</div>":'<div class="hide"><p class="cmnt_top"><span>'+u[g].nick+'</span><span class="cmnt_source">'+u[g].time+"&nbsp;&nbsp;"+u[g].source+"</span><code>"+(g+1)+'</code></p><p class="cmnt_text">'+b+"</p>"+j+"</div>"}0==u.length&&_.surl&&_.surl&&_.stitle&&_.stitle&&(v='<p class="cmnt_quote"><a href="'+_.surl+'">'+_.stitle+"</a></p>"),d+=m+'<p class="cmnt_text">'+_.content+"</p>"+v+'<div class="cmnt_op_bottom clearfix"><p class="cmnt_op_bottom_times">'+_.time+'</p><a class="cmnt_op_bottom_report j_report" href="javascript:;" data-mid="'+_.mid+'">举报</a><span class="cmnt_op"><a href="javascript:void(0);" title="赞" class="good j_favor_single">'+_.agree+'</a><a href="javascript:void(0);" title="评论" class="cmntico j_cmnt_single"></a></span></div></div>'}s.html(i+d),n>=c&&($(".cmnt_more p").html("已加载全部评论"),window.removeEventListener("scroll",r,!1)),e.data("page",n+1)}t&&t()},error:function(e,n){alert("亲，网络出现错误，请重试"),t&&t()}})}function e(){$(document).on("click tap",".j_cmnt_more",function(){var t=$(this),e=t.next();t.remove(),e.removeClass("hide")})}function n(){function t(){var t=$("#j_input_top"),e=$("#j_input_check"),n=t.parent();$(this);if(""==t.val()||t.val()==t.attr("placeholder"))$(".j_op_remind").eq(0).show().html("请输入评论内容！").addClass("animate"),setTimeout(function(){$(".j_op_remind").eq(0).html("").removeClass("animate").hide()},3e3);else if(-1==t.val().indexOf("script")){n.removeClass("_unfold");var s,a=userInfo.nick||userInfo.uname||"手机新浪网用户";'<div class="cmnt_item"><p class="cmnt_top"><span><img src="'+__userface+'" /><i class="cmnt_nick">'+a+'</i><i class="cmnt_time">刚刚</i></span></p><p class="cmnt_text">'+t.val()+"</p></div>",l.html();s=e.is(":checked")?1:"";var i=t.val();t.val(""),$("#j_newslist").prepend('<div class="cmnt_item"><p class="cmnt_top"><span><img src="'+(userInfo.portrait_url||userInfo.userface)+'" /><i class="cmnt_nick">'+a+'</i></span></p><p class="cmnt_text">'+i+'</p><div class="cmnt_op_bottom"><p class="cmnt_op_bottom_times">刚刚</p></div></div>'),$(".cmnt_title").length>1&&window.scrollTo(0,$(".cmnt_title").eq(1).offset().top-10),$("#tipsCeng").length>0&&($("#tipsCeng").show(),setTimeout(function(){$("#tipsCeng").hide()},1500)),$.ajax({type:"POST",url:"aj/cmnt/post?",data:{product:CMNT.product,index:CMNT.index,vcode:CMNT.vcode,csrfcode:CMNT.csrfcode,csrftime:CMNT.csrftime,wburl:CMNT.wburl,vt:4,cmntContent:i,towb:s},dataType:"json",timeout:1e4,success:function(t){t.status&&1==s&&($(".j_op_remind").eq(0).show().html("操作成功，正在发往微博...").addClass("animate"),setTimeout(function(){$(".j_op_remind").eq(0).html("").removeClass("animate").hide()},3e3))},error:function(e,n){t.val("")}})}else $(".j_op_remind").eq(0).show().html("请您检查输入内容！").addClass("animate"),setTimeout(function(){$(".j_op_remind").eq(0).html("").removeClass("animate").hide()},3e3)}function e(){a=$("#j_cmnt_pop"),c=$("#j_cmnt_input");var t=$(this),e="回复"+t.parent().parent().parent().find(".cmnt_nick").eq(0).html().split("<")[0]+"：",n=t.parent().parent().parent().data("mid");s.commentShow(),a&&(c.attr("placeholder",e),a.data("mid",n))}function n(t,e,n){if(a=$("#j_cmnt_pop"),c=$("#j_cmnt_input"),""==t)0==$("#tipsEmpty").length?($("body").append('<aside id="tipsEmpty" class="tipsCeng" style="display: block;"><div class="comment_remind animation_marker"><p class="marker_t">请输入评论内容！</p></div></aside>'),setTimeout(function(){$("#tipsEmpty").hide()},3e3)):($("#tipsEmpty").show(),setTimeout(function(){$("#tipsEmpty").hide()},3e3));else if(-1==t.indexOf("script"))if(o.css("opacity",1),$(".articleHead").css("opacity",1),$(".cmnt_article").css("opacity",1),$("footer").css("opacity",1),$(".j_float_remind").show(),a.data("mid")&&""!=a.data("mid")){var s,r=$(".cmnt_item");for(i=0;i<r.length;i++)if(r.eq(i).data("mid")==a.data("mid")){s=i;break}var d=r.eq(s),m=d.find("code").length+1,p=d.data("mid"),_=d.data("wbname"),u=d.find(".cmnt_nick").eq(0).html(),h=u.split("<")[0];cmnt_sourse=d.find(".cmnt_nick").eq(0).find("em").html(),cmnt_time=d.find(".cmnt_op_bottom_times").eq(0).html(),base=d.find(".cmnt_base").eq(0),text=d.find(".cmnt_text").last(),wb_content=text.html(),_base=d.find(".cmnt_base").length>0?'<div class="cmnt_base">'+base.html()+"</div>":"",_top='<p class="cmnt_top"><span>'+h+'</span><span class="cmnt_source">'+cmnt_time+"&nbsp;&nbsp;"+cmnt_sourse+"</span><code>"+m+"</code></p>",_text='<p class="cmnt_text">'+text.html()+"</p>",s>9&&d.remove();var f='<div class="cmnt_base">'+_base+_top+_text+"</div>",v=userInfo.nick||userInfo.uname||"手机新浪网用户";$("#j_newslist").html();$("#j_newslist").prepend('<div class="cmnt_item"><p class="cmnt_top"><span><img src="'+(userInfo.portrait_url||userInfo.userface)+'" /><i class="cmnt_nick">'+v+"</i></span></p>"+f+'<p class="cmnt_text">'+t+'</p><div class="cmnt_op_bottom"><p class="cmnt_op_bottom_times">刚刚</p></div></div>'),$(".cmnt_list").length>1&&window.scrollTo(0,$(".cmnt_list").eq(1).offset().top-10);var j;j=$("#j_wb_sendcont").is(":checked")?1:"",a.data("mid",""),1==d.data("wbuser")?(e&&e.call(n),$.ajax({type:"POST",url:"aj/cmnt/post?",data:{product:CMNT.product,index:CMNT.index,vcode:CMNT.vcode,csrfcode:CMNT.csrfcode,csrftime:CMNT.csrftime,wburl:CMNT.wburl,vt:4,cmntContent:t,mid:p,nick:_,wb_content:wb_content,towb:j},dataType:"json",timeout:1e4,success:function(t){t.status&&1==j&&($(".j_op_remind").eq(0).show().html("操作成功，正在发往微博...").addClass("animate"),setTimeout(function(){$(".j_op_remind").eq(0).html("").removeClass("animate").hide()},3e3))},error:function(t,e){}})):(e&&e.call(n),$.ajax({type:"POST",url:"aj/cmnt/post?",data:{product:CMNT.product,index:CMNT.index,vcode:CMNT.vcode,csrfcode:CMNT.csrfcode,csrftime:CMNT.csrftime,wburl:CMNT.wburl,vt:4,cmntContent:t,mid:p,towb:j,wb_content:wb_content},dataType:"json",timeout:1e4,success:function(t){t.status&&1==j&&($(".j_op_remind").eq(0).show().html("操作成功，正在发往微博...").addClass("animate"),setTimeout(function(){$(".j_op_remind").eq(0).html("").removeClass("animate").hide()},3e3))},error:function(t,e){}}))}else{var j,v=userInfo.nick||userInfo.uname||"手机新浪网用户",f='<div class="cmnt_item"><p class="cmnt_top"><span><img src="'+(userInfo.portrait_url||userInfo.userface)+'" /><i class="cmnt_nick">'+v+'</i></span></p><p class="cmnt_text">'+t+'</p><div class="cmnt_op_bottom"><p class="cmnt_op_bottom_times">刚刚</p></div></div>',g=l.html();j=$("#j_wb_sendcont").is(":checked")?1:"",l.html(f+g),$(".cmnt_list").length>1&&window.scrollTo(0,$(".cmnt_list").eq(1).offset().top-10),e&&e.call(n),$.ajax({type:"POST",url:"aj/cmnt/post?",data:{product:CMNT.product,index:CMNT.index,vcode:CMNT.vcode,csrfcode:CMNT.csrfcode,csrftime:CMNT.csrftime,wburl:CMNT.wburl,vt:4,cmntContent:t,towb:j},dataType:"json",timeout:1e4,success:function(t){t.status&&1==j&&($(".j_op_remind").eq(0).show().html("操作成功，正在发往微博...").addClass("animate"),setTimeout(function(){$(".j_op_remind").eq(0).html("").removeClass("animate").hide()},3e3))},error:function(t,e){}})}else $(".j_op_remind").eq(0).show().html("请您检查输入内容！").addClass("animate"),setTimeout(function(){$(".j_op_remind").eq(0).html("").removeClass("animate").hide()},3e3)}var s=new Comment({main:$("#mainpage"),cmtsmtCallBack:function(t,e,s){n(t,e,s)}}),a=$("#j_cmnt_pop"),c=$("#j_cmnt_input"),o=$("#j_cmnt_entrance"),l=(c.attr("placeholder"),$("#j_newslist"));$("#j_input_top").on("focus",function(t){checkLogin()||$("#j_input_top").blur()}),$("#j_input_top").on("click",function(t){$(".foot_comment").hide(),checkLogin()||(commentlogin="function"==typeof WapLogin?new WapLogin:this,commentlogin.login(!1,function(){s._addFloat(),s._addEvent(),a=$("#j_cmnt_pop"),c=$("#j_cmnt_input"),$("#j_input_top").focus()}),t.preventDefault())}),$(document).on("click tap","#j_input_smt",function(){t.call(this)}),window.logsuccess=function(t){$("#loginImg img").attr("src",userInfo.portrait_url||userInfo.userface),$("#logoutImg").hide(),$("#loginImg").show()},$(document).on("click tap",".j_cmnt_single",function(){var t=this;checkLogin()?e.call(this):(singlelogin="function"==typeof WapLogin?new WapLogin:this,singlelogin.login(!1,function(n){s._addFloat(),s._addEvent(),e.call(t)}))})}function s(){$(document).on("click tap",".j_cmnt_unfold",function(){var t=$(this).parent(),e=$(this).prev(),n=$(this).parent().find(".hide"),s=t.find(".cmnt_top").last(),a=t.find(".cmnt_text").last(),c=t.find(".cmnt_quote").last(),o='<div class="cmnt_base">'+e.html()+"</div>";if(n.length<8){for(i=0;i<n.length;i++)o='<div class="cmnt_base">'+o+n.eq(i).html()+"</div>";c=c.html()?'<p class="cmnt_quote">'+c.html()+"</p>":"",o+='<div class="cmnt_top">'+s.html()+'</div><div class="cmnt_text">'+a.html()+"</div>"+c,t.html(o)}else{for(i=0;i<n.length;i++)i<7?o='<div class="cmnt_base">'+o+n.eq(i).html()+"</div>":7==n.length?'<div class="cmnt_base">'+o+n.eq(i).html()+"</div>":n.length>9?8==i?o='<div class="cmnt_base">'+o+'<div class="cmnt_extra">'+n.eq(i).html()+"</div>":o+=i<n.length-1?'<div class="cmnt_extra">'+n.eq(i).html()+"</div>":'<div class="cmnt_extra">'+n.eq(i).html()+"</div></div>":8==n.length?o='<div class="cmnt_base">'+o+'<div class="cmnt_extra">'+n.eq(i).html()+"</div></div>":8==i?o='<div class="cmnt_base">'+o+'<div class="cmnt_extra">'+n.eq(i).html()+"</div>":o+='<div class="cmnt_extra">'+n.eq(i).html()+"</div></div>";c=c.html()?'<p class="cmnt_quote">'+c.html()+"</p>":"",o+='<div class="cmnt_extra"><div class="cmnt_top">'+s.html()+'</div><div class="cmnt_text">'+a.html()+"</div>"+c+"</div></div>",t.html(o).addClass("nobd"),t.find(".cmnt_base").eq(0).addClass("nobd"),t.find(".cmnt_base").eq(1).addClass("nomg")}})}function a(){$(document).on("click tap",".j_favor_single",function(){if(!($(this).data("loading")&&"no"!=$(this).data("loading")||$(this).hasClass("on"))){$(this).data("loading","yes");var t,e;if($(this).parent().hasClass("cmnt_op")?(t=$(this).parent().parent().parent().data("mid"),e=$(this).parent().parent().parent().find(".j_favor_single").eq(0)):(t=$(this).parent().parent().data("mid"),e=$(this).parent().parent().find(".j_favor_single").eq(1)),""==t)return!1;var n=parseInt($(this).html());n+=1,$(this).html(n).addClass("on"),e.html(n).addClass("on"),$(this).append($('<i class="fly"></i>')),$.ajax({type:"POST",data:{mid:t,product:CMNT.product,index:CMNT.index,csrfcode:CMNT.csrfcode,csrftime:CMNT.csrftime},url:"aj/cmnt/vote?tj_ch="+__tj_ch,success:function(t){$(this).data("loading","no")},error:function(t,e){$(this).data("loading","no")}})}})}function c(){var t=640;return window.innerHeight?t=window.innerHeight:document.body&&document.body.clientHeight?t=document.body.clientHeight:document.documentElement&&document.documentElement.clientHeight&&(t=document.documentElement.clientHeight),t}function o(){clearInterval(t);var t=setInterval(function(){var t=$(".footer").eq(0).offset().top,e=c(),n=document.body.scrollTop||document.documentElement.scrollTop,s=$("#j_cmnt_entrance");n+e>=t&&n>0?s.hide():s.show()},200)}function l(){var t=$("#mainpage");window.onresize=function(){t.css("minHeight",document.documentElement.clientHeight+"px")},window.addEventListener("scroll",r,!1)}function r(e){function n(){s.addClass("hide"),d=0}var s=($("#pullLoaderContent"),$(".pullLoader")[0],$("#j_pullLoader"));if(0==d){var a=document.body.scrollTop||document.documentElement.scrollTop,i=$(document).height(),c=document.documentElement.clientHeight;if(a+c>=i-c&&(d=1,s.removeClass("hide"),m?t(n):(setTimeout(function(){t(n)},100),m=1),window.suda)){var o=s.data("sudaclick");if(o)var l={type:"loaderMore",name:o,title:"评论上拉加载统计",index:0};window.suds_count&&window.suds_count(l)}}}var d=0,m=0;setTimeout(function(){n(),s(),a(),e(),o(),l()},300)}),$(function(){function t(){var t=[];t.push('<div id ="j_report" class="hide">'),t.push('<div class="comment_report animation_marker hide" id="j_tipsReport"><p class="marker_t">举报成功</p></div>'),t.push('<div class="report_box" id="j_report_box">'),t.push('<h2 class="report_title">举报</h2>'),t.push('<span class="report_reason">请您选择举报的原因</span>'),t.push('<div class="report_select_box" id="j_select_box">'),t.push('<a class="report_select" href="javascript:;" >反动言论</a><a class="report_select" href="javascript:;" >广告营销</a><a class="report_select" href="javascript:;" >淫秽色情</a><a class="report_select" href="javascript:;" >人身攻击</a><a class="report_select" href="javascript:;" >虚假中奖</a>'),t.push("</div>"),t.push('<div class="report_btn_box">'),t.push('<span class="fl"><a href="javascript:;" class="report_cancel" id="j_report_cancel" >取消</a></span><span class="fr"><a href="javascript:;" class="report_smt off" id="j_report_smt" >确定</a></span>'),t.push("</div></div>"),t.push('<div class="report_bg" id="j_report_bg"></div>'),t.push("</div>"),$("body").append(t.join("")),n()}function e(){var e=($("#j_select_box a"),$("#j_report_smt"),$("#j_report_cancel"),$("#mainpage"),$("#j_report_bg")),n=($("#j_tipsReport"),$("#j_report_box")),s=$("#j_report"),a=$(this).parents(".cmnt_item");return 0==s.length&&t(),o={mid:a.data("mid"),charge_uid:a.data("chargeuid")||"",content:a.parents(".com_cont_op").prev().html(),charge_ip:a.data("chargeip")||"",ch:$("#cmnt_channel").val()||"",newsid:a.data("newsid")||"",url:window.location.href||"",jsoncallback:"changeFunction"},l=$(this),$(this).hasClass("on")?void 0:(window.addEventListener("touchmove",c,!1),s.removeClass("hide"),s.removeClass("hide"),n.removeClass("hide"),e.removeClass("hide"),!1)}function n(){var t=$("#j_select_box a"),e=$("#j_report_smt"),n=$("#j_report_cancel"),s=($("#mainpage"),$("#j_report_bg")),a=$("#j_tipsReport"),r=$("#j_report_box"),d=$("#j_report");t.on("click",function(){t.removeClass("on"),$(this).addClass("on"),e.removeClass("off"),o.type=$(this).index()}),n.on("click",function(){d.addClass("hide"),window.removeEventListener("touchmove",c,!1)}),s.on("click",function(){d.addClass("hide"),window.removeEventListener("touchmove",c,!1)}),e.on("click",function(){$(this).hasClass("off")||(t.removeClass("on"),a.removeClass("hide"),r.addClass("hide"),s.addClass("hide"),window.removeEventListener("touchmove",c,!1),l&&l.addClass("on"),l&&l.text("已举报"),setTimeout(function(){d.addClass("hide"),a.addClass("hide")},1e3),i(o),l&&(l=null))})}function s(){$(".j_report").length>0&&$("body").on("click tap",".j_report",function(){return a(e.bind(this)),!1})}function a(t,e){var n="function"==typeof WapLogin?new WapLogin:this;userInfo&&"undefined"!=typeof userInfo?t&&t():n.login(!1,function(){t&&t()})}function i(t){$.ajax({type:"GET",data:t,url:"http://o.cmnt.sina.cn/v2/charge",dataType:"jsonp",async:!1})}function c(t){t.preventDefault()}var o={},l=null;window.changeFunction=function(t){console.log(re)},setTimeout(function(){t(),s()},300)});
//# sourceMappingURL=comment.js.map